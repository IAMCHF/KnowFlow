{
  "test_summary": {
    "total_tests": 21,
    "passed_tests": 10,
    "failed_tests": 11,
    "test_time": "2025-08-16T22:00:12.957937"
  },
  "test_results": [
    {
      "test_name": "分配用户角色",
      "success": true,
      "message": "状态码: 200",
      "timestamp": "2025-08-16T22:00:12.613687",
      "response_data": {
        "expires_at": null,
        "granted_by": "system",
        "message": "成功为用户 test_user 授予角色 editor",
        "resource_id": "kb_001",
        "resource_type": "knowledgebase",
        "role_code": "editor",
        "tenant_id": "default",
        "user_id": "test_user"
      }
    },
    {
      "test_name": "查询用户角色",
      "success": true,
      "message": "状态码: 200, 角色数量: 0",
      "timestamp": "2025-08-16T22:00:12.626341",
      "response_data": {
        "roles": [
          {
            "code": "editor",
            "created_at": "2025-08-13T23:13:30",
            "description": "可以读取、编辑和分享资源",
            "id": 28,
            "is_system": true,
            "name": "编辑者",
            "role_type": "editor",
            "tenant_id": null,
            "updated_at": "2025-08-13T23:13:30"
          }
        ],
        "total": 1,
        "user_id": "test_user"
      }
    },
    {
      "test_name": "查询用户有效权限",
      "success": false,
      "message": "状态码: 500",
      "timestamp": "2025-08-16T22:00:12.628317",
      "response_data": {
        "message": "获取用户有效权限失败: None is not a valid ResourceType",
        "success": false
      }
    },
    {
      "test_name": "删除用户角色",
      "success": true,
      "message": "状态码: 200",
      "timestamp": "2025-08-16T22:00:12.641705",
      "response_data": {
        "message": "成功撤销用户 test_user 的角色 editor",
        "resource_id": "kb_001",
        "role_code": "editor",
        "tenant_id": "default",
        "user_id": "test_user"
      }
    },
    {
      "test_name": "详细权限检查-读权限",
      "success": true,
      "message": "状态码: 200, 有权限: True",
      "timestamp": "2025-08-16T22:00:12.695095",
      "response_data": {
        "granted_roles": [
          "查看者"
        ],
        "has_permission": true,
        "permission_type": "read",
        "reason": "角色权限授权",
        "resource_id": "kb_002",
        "resource_type": "knowledgebase",
        "user_id": "test_user2"
      }
    },
    {
      "test_name": "详细权限检查-写权限",
      "success": true,
      "message": "状态码: 200, 无权限: True",
      "timestamp": "2025-08-16T22:00:12.738326",
      "response_data": {
        "granted_roles": [],
        "has_permission": false,
        "permission_type": "write",
        "reason": "无相关权限",
        "resource_id": "kb_002",
        "resource_type": "knowledgebase",
        "user_id": "test_user2"
      }
    },
    {
      "test_name": "简化权限检查",
      "success": true,
      "message": "状态码: 200, 有权限: True",
      "timestamp": "2025-08-16T22:00:12.760591",
      "response_data": {
        "has_permission": true,
        "permission_code": "kb_read",
        "resource_id": "kb_002",
        "tenant_id": "default",
        "user_id": "test_user2"
      }
    },
    {
      "test_name": "创建团队",
      "success": false,
      "message": "状态码: 404",
      "timestamp": "2025-08-16T22:00:12.762919",
      "response_data": "<!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n"
    },
    {
      "test_name": "查询团队列表",
      "success": false,
      "message": "状态码: 404, 团队数量: 0",
      "timestamp": "2025-08-16T22:00:12.764917",
      "response_data": "<!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n"
    },
    {
      "test_name": "添加团队成员",
      "success": false,
      "message": "状态码: 404",
      "timestamp": "2025-08-16T22:00:12.766607",
      "response_data": "<!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n"
    },
    {
      "test_name": "查询团队成员",
      "success": false,
      "message": "状态码: 404, 成员数量: 0",
      "timestamp": "2025-08-16T22:00:12.768528",
      "response_data": "<!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n"
    },
    {
      "test_name": "为团队分配角色",
      "success": false,
      "message": "状态码: 404",
      "timestamp": "2025-08-16T22:00:12.784987",
      "response_data": "<!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n"
    },
    {
      "test_name": "查询团队角色",
      "success": false,
      "message": "状态码: 404",
      "timestamp": "2025-08-16T22:00:12.794193",
      "response_data": "<!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n"
    },
    {
      "test_name": "查询所有角色",
      "success": true,
      "message": "状态码: 200, 角色数量: 0",
      "timestamp": "2025-08-16T22:00:12.890297",
      "response_data": {
        "data": [
          {
            "code": "viewer",
            "created_at": "2025-08-13T23:13:30",
            "description": "只能查看资源",
            "id": 29,
            "is_system": true,
            "name": "查看者",
            "role_type": "viewer",
            "tenant_id": null,
            "updated_at": "2025-08-13T23:13:30"
          },
          {
            "code": "viewer",
            "created_at": "2025-08-16T21:41:07",
            "description": "只能查看资源",
            "id": 48,
            "is_system": true,
            "name": "查看者",
            "role_type": "viewer",
            "tenant_id": null,
            "updated_at": "2025-08-16T21:41:07"
          },
          {
            "code": "user",
            "created_at": "2025-08-15T20:32:18",
            "description": "基础用户权限",
            "id": 40,
            "is_system": true,
            "name": "用户",
            "role_type": "user",
            "tenant_id": null,
            "updated_at": "2025-08-15T20:32:18"
          },
          {
            "code": "user",
            "created_at": "2025-08-16T21:41:07",
            "description": "基础用户权限",
            "id": 49,
            "is_system": true,
            "name": "用户",
            "role_type": "user",
            "tenant_id": null,
            "updated_at": "2025-08-16T21:41:07"
          },
          {
            "code": "admin",
            "created_at": "2025-08-13T23:13:30",
            "description": "拥有租户内所有权限",
            "id": 27,
            "is_system": true,
            "name": "管理员",
            "role_type": "admin",
            "tenant_id": null,
            "updated_at": "2025-08-13T23:13:30"
          },
          {
            "code": "admin",
            "created_at": "2025-08-16T21:41:07",
            "description": "拥有租户内所有权限",
            "id": 46,
            "is_system": true,
            "name": "管理员",
            "role_type": "admin",
            "tenant_id": null,
            "updated_at": "2025-08-16T21:41:07"
          },
          {
            "code": "editor",
            "created_at": "2025-08-13T23:13:30",
            "description": "可以读取、编辑和分享资源",
            "id": 28,
            "is_system": true,
            "name": "编辑者",
            "role_type": "editor",
            "tenant_id": null,
            "updated_at": "2025-08-13T23:13:30"
          },
          {
            "code": "editor",
            "created_at": "2025-08-16T21:41:07",
            "description": "可以读取、编辑和分享资源",
            "id": 47,
            "is_system": true,
            "name": "编辑者",
            "role_type": "editor",
            "tenant_id": null,
            "updated_at": "2025-08-16T21:41:07"
          },
          {
            "code": "guest",
            "created_at": "2025-08-15T20:30:24",
            "description": "受限的查看权限",
            "id": 35,
            "is_system": true,
            "name": "访客",
            "role_type": "guest",
            "tenant_id": null,
            "updated_at": "2025-08-15T20:30:24"
          },
          {
            "code": "super_admin",
            "created_at": "2025-08-13T23:13:30",
            "description": "拥有系统所有权限",
            "id": 26,
            "is_system": true,
            "name": "超级管理员",
            "role_type": "super_admin",
            "tenant_id": null,
            "updated_at": "2025-08-13T23:13:30"
          },
          {
            "code": "super_admin",
            "created_at": "2025-08-16T21:41:07",
            "description": "拥有系统所有权限",
            "id": 45,
            "is_system": true,
            "name": "超级管理员",
            "role_type": "super_admin",
            "tenant_id": null,
            "updated_at": "2025-08-16T21:41:07"
          }
        ],
        "success": true,
        "total": 11
      }
    },
    {
      "test_name": "查询所有权限",
      "success": false,
      "message": "状态码: 404, 权限数量: 0",
      "timestamp": "2025-08-16T22:00:12.892268",
      "response_data": "<!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n"
    },
    {
      "test_name": "查询角色权限映射",
      "success": false,
      "message": "状态码: 404",
      "timestamp": "2025-08-16T22:00:12.894194",
      "response_data": "<!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n"
    },
    {
      "test_name": "超级管理员-管理权限",
      "success": true,
      "message": "状态码: 200, 有权限: True",
      "timestamp": "2025-08-16T22:00:12.916817",
      "response_data": {
        "granted_roles": [
          "super_admin"
        ],
        "has_permission": true,
        "permission_type": "admin",
        "reason": "超级管理员权限",
        "resource_id": "any_kb",
        "resource_type": "knowledgebase",
        "user_id": "system"
      }
    },
    {
      "test_name": "超级管理员-有效权限",
      "success": false,
      "message": "状态码: 500, 权限数量: 0",
      "timestamp": "2025-08-16T22:00:12.918663",
      "response_data": {
        "message": "获取用户有效权限失败: None is not a valid ResourceType",
        "success": false
      }
    },
    {
      "test_name": "不存在用户权限检查",
      "success": true,
      "message": "状态码: 200, 无权限: True",
      "timestamp": "2025-08-16T22:00:12.948781",
      "response_data": {
        "granted_roles": [],
        "has_permission": false,
        "permission_type": "read",
        "reason": "无相关权限",
        "resource_id": "kb_001",
        "resource_type": "knowledgebase",
        "user_id": "nonexistent_user"
      }
    },
    {
      "test_name": "无效角色分配",
      "success": false,
      "message": "状态码: 500 (应为400)",
      "timestamp": "2025-08-16T22:00:12.955939",
      "response_data": {
        "code": 500,
        "error": "授予角色失败"
      }
    },
    {
      "test_name": "无效权限类型检查",
      "success": true,
      "message": "状态码: 400 (应为400)",
      "timestamp": "2025-08-16T22:00:12.957751",
      "response_data": {
        "code": 400,
        "error": "无效的参数值: 'invalid_permission' is not a valid PermissionType"
      }
    }
  ]
}