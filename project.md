1. 本项目是一个 RAG 系统，/Users/zxwei/zhishi/KnowFlow/knowflow 是独立的微服务，提供 rbac http server 端实现给到主项目使用，如果需要用到该目录下的服务，需要通过  source /Users/zxwei/zhishi/KnowFlow/knowflow/server/venv/bin/activate ，然后 python3.10 来执行脚本。


2. 主项目前端在 /Users/zxwei/zhishi/KnowFlow/web 下面，其他目录都是主项目后端服务。
后端项目可以通过 uv run python3.10 执行脚本。


3. 主项目提供了一个管理页面，只允许超级管理员可见和操作。


我的需求如下，请帮我实现：


# RBAC 权限管理需求文档

## 1. 核心概念

| 概念        | 说明                                                                 |
|-------------|--------------------------------------------------------------------|
| 用户 (User) | 系统最小单位，有登录身份，可以挂角色或继承团队角色能力               |
| 团队 (Team) | 用户集合，可以挂角色，成员自动继承团队角色能力                       |
| 角色 (Role) | 定义用户能力上限（Viewer / Editor / Admin）                        |
| 知识库 (Knowledge Base) | 系统资源对象，每个知识库维护 ACL（角色 → 权限集合）        |

---

## 2. 权限模型

- **角色能力（Role Capability）**  
  - Viewer → 读  
  - Editor → 读 + 写  
  - Admin → 读 + 写 + 管理  

- **知识库 ACL**  
  - 定义角色在该知识库的权限  
  - 用户最终权限 = `(用户角色能力 ∪ 团队角色能力) ∩ 知识库 ACL`  

---

## 3. 默认策略

### 3.1 用户默认策略
- 新建用户默认 **无角色（访客）**  
- 用户无角色 → 无法访问任何知识库  
- 高级功能：管理员可单独给用户挂角色覆盖团队继承  

### 3.2 团队默认策略
- 新建团队默认 **无角色**  
- 团队挂角色后，团队成员继承角色能力  

### 3.3 知识库默认策略
- 系统预置标准 ACL，每个角色默认权限集合：
  | 角色    | 权限       |
  |---------|-----------|
  | Viewer  | 读        |
  | Editor  | 读 + 写   |
  | Admin   | 读 + 写 + 管理 |
- 知识库创建者默认是 Admin  
- 管理员可针对单个知识库手动覆盖角色权限集合  

---

## 4. 操作流程

### 4.1 用户管理
1. 创建用户 → 默认无角色  
2. 管理员可单独挂角色  
3. 用户登录后权限生效 = `(个人角色能力 ∪ 团队角色能力) ∩ 知识库 ACL`

### 4.2 团队管理
1. 创建团队 → 默认无角色  
2. 给团队挂角色（Viewer / Editor / Admin）  
3. 团队成员自动继承团队角色能力  
4. 特殊用户可单独挂角色覆盖团队角色能力  

### 4.3 知识库管理
1. 创建知识库 → 默认应用标准 ACL  
2. 管理员可手动修改 ACL：
   - 修改角色权限集合（读/写/管理）  
3. 用户最终权限 = `(用户角色能力 ∪ 团队角色能力) ∩ 知识库 ACL`  

---

## 5. 权限冲突处理
- 用户个人角色与团队角色同时存在 → **取能力累加（最宽权限）**  
- 用户权限仍需结合知识库 ACL 限制  

---

## 6. 总结设计原则
1. **安全默认**：新用户、团队无角色 → 避免误访问  
2. **批量管理**：通过团队挂角色控制权限  
3. **灵活性**：单个用户或知识库可覆盖默认策略  
4. **统一计算**：用户最终权限 = `(用户个人角色能力 ∪ 团队角色能力) ∩ 知识库 ACL`  
5. **默认 ACL + 个性化覆盖** → 降低管理成本，同时保证安全  

---

